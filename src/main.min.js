--- AES Key Exportplain"});
    const url=URL.createObjectURL(blob);
    const a=document.createElement("a");
    a.href=url; a.download="ciphernexus-key.txt"; a.click();
    URL.revokeObjectURL(url);
}
async function importAESKeyFromFile(file){
    const text=await file.text();
    const bytes=Uint8Array.from(atob(text.trim()),c=>c.charCodeAt(0));
    const key=await crypto.subtle.importKey(
        "raw",bytes,{name:"AES-GCM"},true,["encrypt","decrypt"]
    );
    window.__CIPHERNEXUS_AES_KEY=key;
    console.log("AES key imported");
}
 --- END AES Key Exportcrypto.js';

const $ = (id)=>document.getElementById(id);
const roomInput = $('roomCode');
const deriveBtn = $('deriveBtn');
const encryptBtn = $('encryptBtn');
const decryptBtn = $('decryptBtn');
const plaintext = $('plaintext');
const result = $('result');

let session = { key: null, salt: null };

deriveBtn.addEventListener('click', async ()=>{
  const pass = roomInput.value || prompt('Enter a room code import keys, drag-drop, session export, QR render ---
async function exportAESKey(){ try{ if(!window.__CIPHERNEXUS_AES_KEY){ alert('No key derived'); return; } const raw = await crypto.subtle.exportKey('raw', window.__CIPHERNEXUS_AES_KEY); const b64 = btoa(String.fromCharCode(...new Uint8Array(raw))); const blob = new Blob([b64],{type:'text\+\g,'_').replace(,''); }
function base64UrlDecode(b64u){ b64u = b64u.replace(g,'+').replace(g,'2, 20); const lines = text.match(g)||[text]; for(let i=0;i<lines.length;i++) ctx.fillText(lines[i], canvas.width password:');
      if(!pass) return;
      const r = await window.cryptoMod?.deriveAesKeyFromPassword?.(pass) || (await (async ()=>{ const o = await window.cryptoMod.deriveAesKeyFromPassword(pass); return o; })());
       if deriveAesKeyFromPassword returns salt in base64, convert to base64url
      const saltB64 = r && r.salt ? r.salt : '';
      const saltB64u = saltB64 ? saltB64.replace(g,'-').replace(=+$/ --- end UI integration ---